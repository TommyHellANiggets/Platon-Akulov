AddDefaultCharset UTF-8

RewriteEngine On

# Перенаправление с HTTP на HTTPS (только если запрос пришел по HTTP)
RewriteCond %{HTTPS} off
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# Обработка статических файлов напрямую
RewriteRule ^static/(.*)$ static/$1 [L]
RewriteRule ^media/(.*)$ media/$1 [L]

# Обработка статических файлов по расширению
RewriteCond %{REQUEST_URI} \.(jpg|jpeg|png|gif|ico|css|js|eot|woff|woff2|ttf|svg|pdf)$
RewriteRule ^(.*)$ $1 [L]

# Разрешаем доступ к панели управления
RewriteCond %{REQUEST_URI} ^/dashboard
RewriteRule ^(.*)$ passenger_wsgi.py/$1 [QSA,L]

# Разрешаем доступ к админке
RewriteCond %{REQUEST_URI} ^/admin
RewriteRule ^(.*)$ passenger_wsgi.py/$1 [QSA,L]

# Разрешаем доступ к авторизации
RewriteCond %{REQUEST_URI} ^/login
RewriteRule ^(.*)$ passenger_wsgi.py/$1 [QSA,L]

RewriteCond %{REQUEST_URI} ^/logout
RewriteRule ^(.*)$ passenger_wsgi.py/$1 [QSA,L]

# Перенаправляем все остальные запросы на passenger_wsgi.py
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ passenger_wsgi.py/$1 [QSA,L]

# Настройки PHP (если используется)
<IfModule mod_php7.c>
    php_flag display_errors Off
    php_flag log_errors On
    php_value error_log /var/www/u3052942/data/logs/php_errors.log
    php_value error_reporting 0
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>

# Кеширование статических файлов
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresDefault "access plus 2 days"
</IfModule>

# Сжатие файлов
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/x-javascript
</IfModule> 